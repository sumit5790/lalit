pipeline{
       agent any
	   environment {
        SAUCE_ACCESS = credentials('private-docker')
		
		}
		
		stages {
        stage('Build') {
            steps {
                // Print all the environment variables.
                sh 'printenv'
                sh 'echo $GIT_BRANCH'
                sh 'echo $GIT_COMMIT'
                echo 'Install non-dev composer packages and test a symfony cache clear'
                sh 'docker build -f $(pwd)/Dockerfile -t 172.31.30.63:5000:$GIT_COMMIT .'
            }
        }

		stage('Push') {
            when {
                branch 'master'
            }
            steps {
                echo 'Deploying docker images'
		sh 'docker tag 172.31.30.63:5000:$GIT_COMMIT 172.31.30.63:5000/new_image '
                sh 'docker push 172.31.30.63:5000/new_image:latest'
            }
        }
    }
}
